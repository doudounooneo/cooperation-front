<navigation-bar title="хо╢х║нчобчРЖ" back="{{true}}" color="black" background="#FFF"></navigation-bar>
<scroll-view class="jd-page" scroll-y enhanced show-scrollbar="{{false}}">
  <view class="page-content">
    <!-- хИЫх╗║хо╢х║н -->
    <block wx:if="{{mode==='create'}}">
      <view class="form-section">
        <view class="form-header">
          <text class="form-icon">ЁЯПа</text>
          <text class="form-title">хИЫх╗║цЦ░хо╢х║н</text>
        </view>
        <view class="form-hint">хИЫх╗║хРОцВиф╝ЪцИРф╕║ш┐Щф╕кхо╢х║нчЪДхо╢щХ┐</view>
        <view class="form-group">
          <text class="form-label">хо╢х║нхРНчз░</text>
          <input class="form-input" placeholder="ф╛ЛхжВя╝Ъц╕йщжих░Пхо╢" bindinput="onNameInput" value="{{name}}" />
        </view>
        <button class="btn btn-primary" bindtap="createFamily">хИЫх╗║хо╢х║н</button>
      </view>
    </block>
    
    <!-- ч╗СхоЪхо╢х║н -->
    <block wx:elif="{{mode==='bind'}}">
      <view class="form-section">
        <view class="form-header">
          <text class="form-icon">ЁЯФЧ</text>
          <text class="form-title">хКахЕех╖▓цЬЙхо╢х║н</text>
        </view>
        <view class="form-hint">ш╛УхЕехо╢ф║║хИЖф║лчЪДщВАшп╖чаБхКахЕеф╗Цф╗мчЪДхо╢х║н</view>
        <view class="form-group">
          <text class="form-label">щВАшп╖чаБ</text>
          <input class="form-input" placeholder="шп╖ш╛УхЕещВАшп╖чаБ" bindinput="onCodeInput" value="{{codeInput}}" />
        </view>
        <button class="btn btn-primary" bindtap="bindFamily">хКахЕехо╢х║н</button>
      </view>
    </block>
    
    <!-- хо╢х║нхИЧшби -->
    <block wx:else>
      <!-- цУНф╜ЬцМЙщТо -->
      <view class="action-row">
        <view class="action-card" bindtap="goCreate">
          <text class="action-icon">тЬи</text>
          <text class="action-text">хИЫх╗║хо╢х║н</text>
        </view>
        <view class="action-card" bindtap="goBind">
          <text class="action-icon">ЁЯФЧ</text>
          <text class="action-text">хКахЕехо╢х║н</text>
        </view>
      </view>

      <view class="section-header">
        <text class="section-title">цИСчЪДхо╢х║н</text>
        <text class="section-count">{{families.length}} / {{maxFamilies}}</text>
      </view>
      
      <view class="family-list">
        <block wx:for="{{families}}" wx:key="id">
          <view class="family-card {{item.id === currentFamilyId ? 'current' : ''}}">
            <view class="family-main">
              <view class="family-info">
                <view class="family-name">
                  {{item.name}}
                  <text wx:if="{{item.id === currentFamilyId}}" class="current-tag">х╜УхЙН</text>
                </view>
                <view class="family-code">
                  <text class="code-label">щВАшп╖чаБя╝Ъ</text>
                  <text class="code-value">{{item.inviteCode || item.id}}</text>
                </view>
              </view>
              <view class="family-actions">
                <button class="icon-btn" bindtap="copyCode" data-code="{{item.inviteCode || item.id}}">ЁЯУЛ</button>
                <button class="icon-btn" bindtap="shareFamily" data-code="{{item.inviteCode || item.id}}" data-name="{{item.name}}">ЁЯУд</button>
              </view>
            </view>
            <view class="family-footer">
              <button wx:if="{{item.id !== currentFamilyId}}" 
                      class="link-btn primary" 
                      bindtap="switchCurrent" 
                      data-id="{{item.id}}">шо╛ф╕║х╜УхЙН</button>
              <button class="link-btn danger" 
                      bindtap="leaveFamily" 
                      data-id="{{item.id}}" 
                      data-name="{{item.name}}">щААхЗ║хо╢х║н</button>
            </view>
          </view>
        </block>
      </view>
      
      <!-- цИРхСШхИЧшбия╝Их╜УхЙНхо╢х║ня╝Й -->
      <view wx:if="{{members.length > 0}}" class="members-section">
        <view class="section-header">
          <text class="section-title">хо╢х║нцИРхСШ</text>
          <text class="section-count">{{members.length}} ф║║</text>
        </view>
        <view class="member-list">
          <block wx:for="{{members}}" wx:key="userId">
            <view class="member-card">
              <image class="member-avatar" src="{{item.avatarUrl}}" mode="aspectFill" />
              <view class="member-info">
                <view class="member-name">
                  {{item.nickName}}
                  <text wx:if="{{item.userId === userId}}" class="me-tag">цИС</text>
                </view>
                <view class="member-role {{item.role}}">
                  {{item.role === 'parent' ? 'ЁЯСС хо╢щХ┐' : 'ЁЯСд цИРхСШ'}}
                </view>
              </view>
              <view class="member-points">
                <text class="points-value">{{item.points || 0}}</text>
                <text class="points-label">чзпхИЖ</text>
              </view>
              <!-- хо╢щХ┐цЙНшГ╜чобчРЖцИРхСШ -->
              <view wx:if="{{isParent && item.userId !== userId}}" class="member-actions">
                <button class="mini-btn" 
                        bindtap="setMemberRole" 
                        data-user-id="{{item.userId}}" 
                        data-role="{{item.role}}">
                  {{item.role === 'parent' ? 'шо╛ф╕║цИРхСШ' : 'шо╛ф╕║хо╢щХ┐'}}
                </button>
                <button class="mini-btn danger" 
                        bindtap="removeMember" 
                        data-user-id="{{item.userId}}" 
                        data-name="{{item.nickName}}">чз╗щЩд</button>
              </view>
            </view>
          </block>
        </view>
      </view>
      
      <!-- чй║чК╢цАБ -->
      <view wx:if="{{families.length === 0}}" class="empty-section">
        <text class="empty-icon">ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж</text>
        <text class="empty-text">ш┐Шц▓бцЬЙхКахЕехо╢х║н</text>
        <text class="empty-hint">хИЫх╗║ф╕Аф╕кхо╢х║нцИЦхКахЕех╖▓цЬЙхо╢х║н</text>
      </view>
    </block>
  </view>
</scroll-view>
